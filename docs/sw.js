const CACHE_NAME="storyapp-v1",API_URL="https://story-api.dicoding.dev/v1/stories",urlsToCache=["/","/index.html","/app.bundle.js","/manifest.json","/favicon.png","/icons/icon-192x192.png"];self.addEventListener("install",(e=>{console.log("Service Worker: Installing..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Service Worker: Caching App Shell assets"),Promise.all(urlsToCache.map((n=>e.add(n).catch((e=>{console.warn("Gagal cache:",n,e)})))))))))})),self.addEventListener("activate",(e=>{console.log("Service Worker: Activating..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Service Worker: Deleting old cache:",e),caches.delete(e)}))))))})),self.addEventListener("fetch",(e=>{const{request:n}=e;n.url.startsWith(API_URL)?e.respondWith(fetch(n).catch((()=>new Response(JSON.stringify({stories:[],error:"offline"}),{headers:{"Content-Type":"application/json"}})))):e.respondWith(caches.match(n).then((e=>e||fetch(n))))})),self.addEventListener("push",(e=>{const n=e.data?.json()||{},t=n.title||"Pesan Baru Story App",i={body:n.message||"Anda punya notifikasi baru dari Story App.",icon:"/icons/icon-192x192.png",data:{url:n.url||"#/home"}};e.waitUntil(self.registration.showNotification(t,i))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const n=e.notification.data.url;e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(const t of e)if(t.url===n&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow(n)})))}));